<!DOCTYPE html>
<html>
<head>
	<title>Widget Setting</title>

	
	<script src="assets/jquery/jquery-2.1.0.min.js"></script>
	<script src="assets/bootstrap/js/bootstrap.min.js"></script>
	<script src="assets/knockout/knockout-3.4.0.js"></script>
	<script src="assets/knockout/knockout.mapping.js"></script>	
	<script src="assets/kendo-ui/js/kendo.all.min.js"></script>
	<script src="assets/knockout-kendo/knockout-kendo.min.js"></script>
	<script src="assets/colorpicker/js/colorpicker.js"></script>
	
	<!-- <script src="assets/jscolor.js"></script> -->
	<script src="assets/moment/moment.min.js"></script>
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" />
	<!-- kendo-ui -->
	<link href="assets/kendo-ui/styles/kendo.default.min.css" rel="stylesheet">

	<link href="assets/kendo-ui/styles/kendo.common-bootstrap.min.css" rel="stylesheet">

	<link href="assets/kendo-ui/styles/kendo.bootstrap.min.css" rel="stylesheet">
	<link href="assets/kendo-ui/styles/kendo.dataviz.min.css" rel="stylesheet">
	<link href="assets/kendo-ui/styles/kendo.dataviz.bootstrap.min.css" rel="stylesheet">
	<link href="assets/colorpicker/css/colorpicker.css" rel="stylesheet">
	<style type="text/css">
		.k-widget.k-dropdown, .k-widget.k-numerictextbox{
			width: 100%;
		}
		body {
			
			font-size: 13px;
		}
		#page-container{
			height: 900px;
			overflow: scroll;
		}
	/*	.series {
			height: 250px;
			overflow: scroll;
		}*/
		
	</style>
	<script>var vm = new Object();</script>
	<script type="text/javascript">

		vm.templateConfig = {
			title : {
		 		text: "",
		 		position:"",
                margin:{
                	visible: 0,
                	top:0,
                	right:0,
                	bottom:0,
                	left:0
                },
                padding:{
                	visible: 0,
                	top:0,
                	right:0,
                	bottom:0,
                	left:0
                }
		 	},
		 	defaultType:"",
			legend:{
		 		visible:"",
		 		background:"",
		 		position:"",
		 		labels:{
		 			font:"",
		 			color:"",
		 			border: {
		 				visible: "",
                        dashType: "",
                        width: "",
                    	color:""
                    }
		 		}
		 	},
		 	tooltip:{
		 		visible:"",
		 		color:"",
		 		font:"",
		 		background:"",
		 		border:{
		 			visible: "",
		 			width:"",
		 			color:""
		 		}
		 	},
		 	chartArea:{
		 		background:""
		 	},
		 	categoryAxis: {
				field:""
		 	},
		 	series: []
		}
		
		vm.templateConfigSeries  =  {
			name :"",
			field:"",
			type :"",
			data :"",
			id   :"",
			color:""
		}
		
		vm.templateDataSource = {
			dsChart:{
				dataSource:"",
				fields:""
			}
		}
		
		vm.templateFields = {
			name:""
		}
		
		vm.tamplatePositions = [{
			name:"top",
		},{
			name:"bottom",
		},{
			name:"right",
		},{
			name:"left",
		}];
		
		vm.templateTypeSeries =[{
			name:"line",
		},{
			name:"bar"
		}];
		
		vm.templateBorderStyle = [{
			name:"dash"
		},{
			name:"dashDot"
		},{
			name:"dot"
		},{
			name:"longDash"
		},{
			name:"longDashDot"
		},{
			name:"solid"
		}];
	
		vm.config = ko.mapping.fromJS(vm.templateConfig);
		vm.dataSource = ko.mapping.fromJS(vm.templateDataSource);
		vm.fields = ko.observableArray([])
		vm.positions = ko.mapping.fromJS(vm.tamplatePositions)
		vm.typeSeries = ko.mapping.fromJS(vm.templateTypeSeries)
		vm.borderStyle = ko.mapping.fromJS(vm.templateBorderStyle)
		
		vm.showLegend = ko.observable(false);
		vm.showTooltip = ko.observable(false);
		vm.showTooltipBorder = ko.observable(false);
		vm.showTitleMargin = ko.observable(false);
		vm.showTitlePadding= ko.observable(false);

		vm.addSeries = function () {
			var series = $.extend(true, {}, vm.templateConfigSeries);
	    	series.id = "s" + moment.now();

	    	var config = ko.mapping.toJS(vm.config);

	    	config.series.push(series);
	    	ko.mapping.fromJS(config, vm.config);
	    	$("input[id^='seriesColor']").kendoColorPicker()
		};

		vm.getConfig = function () {
			return ko.mapping.toJS(vm.config);
		}

		// ko.mapping.toJS($("#WidgetSetting iframe")[0].contentWindow.vm.config)

		vm.removeSeries = function(each){
			return function () {
				vm.config.series.remove(each);
			};
	    };
	    vm.titleMarginCheckVisible = function(){
			config = ko.mapping.toJS(vm.config);
			vm.showTitleMargin(!config.title.margin.visible)
	    }
	     vm.titlePaddingCheckVisible = function(){
			config = ko.mapping.toJS(vm.config);
			vm.showTitlePadding(!config.title.padding.visible)
	    }
		vm.legendCheckVisible =function(){
			config = ko.mapping.toJS(vm.config);
			vm.showLegend(!config.legend.visible);
			vm.renderColorPicker("legend");
		}

	    vm.tooltipCheckVisible =function(){
	    	config = ko.mapping.toJS(vm.config);
			vm.showTooltip(!config.tooltip.visible);
			vm.renderColorPicker("tooltip");
		}

		vm.tooltipBorderCheckVisible =function(){
			config = ko.mapping.toJS(vm.config);
			vm.showTooltipBorder(!config.tooltip.border.visible);
			vm.renderColorPicker("tooltipBorderColor");
		}

		vm.renderColorPicker = function(id=""){
			idColor =["legendBackColor","legendFontColor","tooltipBackColor","tooltipFontColor","tooltipBorderColor","seriesColor","legendBorderColor","titleBorderColor"]

      		idColor.forEach(function(e,i){
      			if(id === ""){
      				if(e === "seriesColor"){
      					$("input[id^='"+e+"']").kendoColorPicker()
      				}
      				$("#"+e).kendoColorPicker();
      			}else{
      				if(e.indexOf(id) !== -1){
      					$("#"+e).kendoColorPicker();
      				}
      			}
      		});
      		

		}
	   
		function SetFormData(dataSources, config) {
			ko.mapping.fromJS(dataSources, vm.dataSource);
			dataSources.dsChart.fields.forEach(function (d) {
            	var each = $.extend(true, {}, vm.templateFields);
            	each.name = ko.observable(d);
      
           		vm.fields.push(each);
      		});
      		if ([undefined, null].indexOf(config) == -1) {
	      		vm.showLegend(config.legend.visible)
	      		vm.showTooltip(config.tooltip.visible)
				vm.showTooltipBorder(config.tooltip.border.visible)
				vm.showTitleMargin(config.title.margin.visible)
				vm.showTitlePadding(config.title.padding.visible)
			}
      		ko.mapping.fromJS(config,vm.config);

			vm.renderColorPicker();
			
		};
		
		function GetFormData() {

			config = ko.mapping.toJS(vm.config);
	
			config.legend.visible = (config.legend.position === "")? false : true; 
			
			$.each(config.series,function(index,value){
				if(value.type === "")
					config.series[index].type = config.defaultType;
			});

			(config.title.position ==="" )?"top":config.title.position;



			config.legend.labels.border.width= parseInt(config.legend.labels.border.width);
			config.tooltip.border.width = parseInt(config.tooltip.border.width)
			
			["top","left","bottom","right"].forEach(function(e,i){
				if(config.title.margin.visible === false){
					config.title.margin[e] = 0;
				}
				if(config.title.padding.visible === false){
					config.title.padding[e] = 0;
				}else{
					config.title.margin[e] = parseInt(config.title.margin[e])
					config.title.padding[e] = parseInt(config.title.padding[e])
				}
			})
			return config;
		};
	</script>
</head>
	<body>
		<div id="page-container">
			<form class="form-horizontal" id="widgetSettingForm" data-bind="with: vm">
			<div class="col-sm-12">

				<div class="form-group">
					<label class="col-sm-2 control-label">data Source 1 (dsChart)</label>
					<div class="col-sm-10">
					<input type="text" class="form-control" data-bind="value:dataSource.dsChart.dataSource" disabled="disable" />
					</div>
				</div>
			</div>

			<div class="col-xs-8">
				<div class="form-group">
					<label class="col-sm-2 control-label">Chart Title</label>
					<div class="col-sm-10">
					<input required type="text" class="form-control" data-bind="value: config.title.text">
					</div>
				</div>
			</div>	
			<div class="col-xs-4">
				<div class="form-group">
					<label class="col-sm-2 control-label">Title Position</label>
					<div class="col-sm-10">
					<input style="width: 100%;" required data-bind="kendoDropDownList : {value:config.title.position, data: positions, dataTextField: 'name', dataValueField: 'name', optionLabel: 'Select One'}"/>
					</div>
				</div>
			</div>
			
			<div class="clearfix"></div>

			<div class="col-sm-12">
				<!-- <div class="col-xs-3 col-md-3">
				<div class="form-group">
			 		<label class="col-xs-9 control-label" style="padding: 10">Use Border</label>
			 		<div class="col-sm-3">
			 		<input type="checkbox" data-bind="checked: config.title.border.visible" />
					</div>

				</div>
				</div>

				<div data-bind="style: { 'visibility': config.title.border.visible() ? 'visible' : 'hidden' }">
					<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Border width (Px)</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input required type="number" data-bind="value: config.title.border.width" class="form-control" >
					 	</div>
					</div>
					</div>

					<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Border Color</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input id="titleBorderColor" data-bind="value: config.title.border.color" type="color" class="form-control" />
					 	</div>
					</div>
					</div>

					<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Border Style</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input style="width: 100%;" required data-bind="kendoDropDownList : {value: config.title.border.dashType, data: borderStyle, dataTextField: 'name', dataValueField: 'name', optionLabel: 'Solid'}"/>
					 	</div>
					</div>
					</div>
				</div> -->
				
			<div class="col-xs-12 col-md-12">
				<div class="form-group">
			 	<label class="col-xs-2 control-label">Margin</label>
			 		<div class="col-sm-10">
			 		<input type="checkbox" data-bind="checked: config.title.margin.visible" onclick="vm.titleMarginCheckVisible()" />
					</div> 
				</div>
				<div data-bind="if:showTitleMargin">

				<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Top</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input required type="number" data-bind="value: config.title.margin.top" class="form-control" >
					 	</div>
					</div>
				</div>
				<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Right</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input required type="number" data-bind="value: config.title.margin.right" class="form-control" >
					 	</div>
					</div>
				</div>	
				<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Bottom</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input required type="number" data-bind="value: config.title.margin.bottom" class="form-control" >
					 	</div>
					</div>
				</div>	
				<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Left</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input required type="number" data-bind="value: config.title.margin.left" class="form-control" >
					 	</div>
					</div>
				</div>
				</div>	
			</div>

			<div class="col-xs-12 col-md-12">
				<div class="form-group">
			 	<label class="col-xs-2 control-label">Padding</label>
			 		<div class="col-sm-10">
			 		<input type="checkbox" data-bind="checked: config.title.padding.visible" onclick="vm.titlePaddingCheckVisible()" />
					</div> 
				</div>

				<div data-bind="if:showTitlePadding">
				<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Top</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input required type="number" data-bind="value: config.title.padding.top" class="form-control" >
					 	</div>
					</div>
				</div>
				<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Right</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input required type="number" data-bind="value: config.title.padding.right" class="form-control" >
					 	</div>
					</div>
				</div>	
				<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Bottom</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input required type="number" data-bind="value: config.title.padding.bottom" class="form-control" >
					 	</div>
					</div>
				</div>	
				<div class="col-xs-3 col-md-3">
					<div class="form-group">
					 	<label class="col-sm-2 control-label">Left</label>
					 	<div class="col-xs-12 col-md-12">
					 	<input required type="number" data-bind="value: config.title.padding.left" class="form-control" >
					 	</div>
					</div>
				</div>
				</div>	
			</div>
			</div>

			<div class="clearfix"></div>

			<div class="col-sm-12">
				<div class="form-group">
			 	<label class="col-sm-2 control-label">Catgory Axis</label>
			 		<div class="col-sm-10">
					<input name="" style="width: 100%;" required data-bind="kendoDropDownList : {value: config.categoryAxis.field, data: fields, dataTextField: 'name', dataValueField: 'name', optionLabel: 'Select one'}" id="appLanguage"/>
					</div>
				</div>
				
				<div class="form-group">
			 	<label class="col-sm-2 control-label">Series Type Default</label>
			 		<div class="col-sm-10">
					<input  style="width: 100%;" required data-bind="kendoDropDownList : {value:config.defaultType, data: typeSeries, dataTextField: 'name', dataValueField: 'name', optionLabel: 'none'}" id="appLanguage"/>
					</div>
				</div>


				<div class="form-group">
			 	<label class="col-xs-2 control-label">Use Legend</label>
			 		<div class="col-sm-10">
			 		<input type="checkbox" data-bind="checked: config.legend.visible" onclick="vm.legendCheckVisible()" />
					</div> 
				</div>
			
				<!-- <div data-bind="style: { 'visibility': config.legend.visible() ? 'visible' : 'hidden' }"> -->
				<div data-bind="if:showLegend">

					<div class="col-xs-3 col-md-3">
					<div class="form-group">
			 		<label class="col-sm-2 control-label">Legend Position</label>
			 			<div class="col-xs-12 col-md-12">
						<input style="width: 100%;" required data-bind="kendoDropDownList : {value:config.legend.position, data: positions, dataTextField: 'name', dataValueField: 'name', optionLabel: 'Select One'}"/>
						</div>
					</div>
					</div>

					<div class="col-xs-3 col-md-3">
					<div class="form-group">
			 			<label class="col-sm-2 control-label">Background</label>
			 			<div class="col-xs-12 col-md-12">
			 			<input id="legendBackColor"  data-bind="  value: config.legend.background" type="color" class="form-control" />

			 			</div>
					</div>
					</div>

					<div class="col-xs-3 col-md-3">
					<div class="form-group">
			 			<label class="col-sm-3 control-label">Font Size (Px)</label>
			 			<div class="col-xs-12 col-md-12">
			 			<input required type="number" data-bind="value:config.legend.labels.font" class="form-control" >
			 			</div>
					</div>
					</div>
				
					<div class="col-xs-3 col-md-3">
					<div class="form-group">
				 		<label class="col-sm-2 control-label">Font Color</label>
				 		<div class="col-xs-12 col-md-12">
				 		
						<input id="legendFontColor"  data-bind="  value: config.legend.labels.color" type="color" class="form-control" />
				 		</div>
					</div>
					</div>
					
					<div class="clearfix"></div>

					<div class="col-xs-3 col-md-3">
					<div class="form-group">
			 			<label class="col-xs-10 control-label" style="padding: 10">Use Border</label>
			 			<div class="col-sm-2">
			 			<input type="checkbox" data-bind="checked: config.legend.labels.border.visible"/>
						</div> 
					</div>
					</div>

					<div data-bind="style: { 'visibility': config.legend.labels.border.visible() ? 'visible' : 'hidden' }">
						<div class="col-xs-3 col-md-3">
						<div class="form-group">
					 		<label class="col-sm-2 control-label">Border width (Px)</label>
					 		<div class="col-xs-12 col-md-12">
					 		<input required type="number" data-bind="value: config.legend.labels.border.width" class="form-control" >
					 		</div>
						</div>
						</div>

						<div class="col-xs-3 col-md-3">
						<div class="form-group">
					 		<label class="col-sm-2 control-label">Border Color</label>
					 		<div class="col-xs-12 col-md-12">

					 		<input id="legendBorderColor" data-bind="value: config.legend.labels.border.color" type="color" class="form-control" />
					 		</div>
						</div>
						</div>

						<div class="col-xs-3 col-md-3">
						<div class="form-group">
					 		<label class="col-sm-2 control-label">Border Style</label>
					 		<div class="col-xs-12 col-md-12">
					 		<input style="width: 100%;" required data-bind="kendoDropDownList : {value: config.legend.labels.border.dashType, data: borderStyle, dataTextField: 'name', dataValueField: 'name', optionLabel: 'Solid'}"/>
					 		</div>
						</div>
						</div>

					</div>

				</div>
				
				
				<div class="clearfix"></div>

				<div class="form-group">
			 	<label class="col-xs-2 control-label">Use Tooltip</label>
			 		<div class="col-sm-10">
			 		<input type="checkbox" data-bind="checked: config.tooltip.visible" onclick="vm.tooltipCheckVisible()" />
					</div> 
				</div>

				<div data-bind="if:showTooltip">
					<!-- <div data-bind="style: { 'visibility': config.tooltip.visible() ? 'visible' : 'hidden' }"> -->
					<div class="col-xs-3 col-md-3">
					<div class="form-group">
				 		<label class="col-sm-2 control-label">Background</label>
				 		<div class="col-xs-12 col-md-12">
				 		<input id="tooltipBackColor"  data-bind="value: config.tooltip.background" type="color" class="form-control" />
				 		</div>
					</div>
					</div>

					<div class="col-xs-3 col-md-3">
					<div class="form-group">
				 		<label class="col-sm-2 control-label">Font Size (Px)</label>
				 		<div class="col-xs-12 col-md-12">
				 		<input required type="number" data-bind="value:config.tooltip.font" class="form-control" >
				 		</div>
					</div>
					</div>

					<div class="col-xs-3 col-md-3">
					<div class="form-group">
				 		<label class="col-sm-2 control-label">Font Color</label>
				 		<div class="col-xs-12 col-md-12">
				 		<input id="tooltipFontColor"  data-bind="value: config.tooltip.color" type="color" class="form-control" />
				 		</div>
					</div>
					</div>

					<div class="col-xs-3 col-md-3">
					<div class="form-group">
			 			<label class="col-sm-9 control-label">Use Border</label>
			 			<div class="col-md-3">
			 			<input type="checkbox" data-bind="checked: config.tooltip.border.visible" onclick="vm.tooltipBorderCheckVisible()" />
						</div>
					</div>
					</div>
					
					<div class="clearfix"></div>

					<!-- <div data-bind="style: { 'visibility': (config.tooltip.border.visible() && config.tooltip.visible() ) ? 'visible' : 'hidden' }"> -->
					<div data-bind="if:showTooltipBorder">
						<div class="col-xs-6 col-md-6">
						<div class="form-group">
					 		<label class="col-sm-2 control-label">Border width (Px)</label>
					 		<div class="col-xs-12 col-md-12">
					 		<input required type="number" data-bind="value:config.tooltip.border.width" class="form-control" >
					 		</div>
						</div>
						</div>

						<div class="col-xs-6 col-md-6">
						<div class="form-group">
					 		<label class="col-sm-2 control-label">Tooltip Border Color</label>
					 		<div class="col-xs-12 col-md-12">

					 		<input id="tooltipBorderColor" data-bind="value: config.tooltip.border.color" type="color" class="form-control" />
					 		</div>
						</div>
						</div>

					</div>
				</div>


			<div class="clearfix"></div>
					
				<button class="btn btn-sm btn-primary" data-bind="click: addSeries">
					<span class="glyphicon glyphicon-plus"></span> Add Series
				</button>
				
				<div  data-bind="foreach: config.series" class="series">
					<div class="col-md-12 col-xs-12">
					
					<div class="col-md-3 col-xs-3">
						<label class="col-md-12 col-xs-12">Name:</label>
						<input class="form-control" type="text" data-bind="value: name" />
					</div>
					
					<div class="col-md-3 col-xs-3">
						<label class="col-md-12 col-xs-12">Field :</label>
					
							<input style="width: 100%;" required data-bind="kendoDropDownList : {value: field, data: vm.fields, dataTextField: 'name', dataValueField: 'name', optionLabel: 'Select one'}" id="appLanguage"/>

					</div>
					
					<div class="col-md-2 col-xs-2 ">
						<label class="col-md-12 col-xs-12">Type</label>
						<input style="width: 100%;" required data-bind="kendoDropDownList : {value: vm.config.series()[$index()].type, data: vm.typeSeries, dataTextField: 'name', dataValueField: 'name', optionLabel: 'none'}" id="appLanguage"/>
					</div>
					<div class="col-md-2 col-xs-2">
						<label class="col-md-12 col-xs-12" >Color</label>
						<input data-bind="value: color, attr: {'id': 'seriesColor' + $index()}" type="color" class="form-control" />
			        </div>
					 
					<div class="col-md-2 col-xs-2" style="padding: 10">
						<label class="col-md-12 col-xs-12" >Option</label>

						<button  type='button' class="btn btn-sm btn-danger" 
						 data-bind="click: vm.removeSeries($data)">
			        	
			        	<span index='0' class="glyphicon glyphicon-remove" ></span>
			        	
			        	</button>
			        </div>

					</div>
				</div>
				<div class="clearfix"></div>
			<!-- 	<button onclick="GetFormData()">S</button> -->
			</form>
		</div>
		<script>ko.applyBindings(vm);</script>
	</body>
</html>